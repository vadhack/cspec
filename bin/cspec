#!/usr/bin/env coffee

path = require('path');
fs = require('fs')
coffee = require('coffee-script')
lib = path.join(path.dirname(fs.realpathSync(__filename)), '../out')
CSpec = require(lib + '/cspec.js').CSpec
commander = require('commander');
commander.version('0.0.2')
         .usage('[options]')
         .option('-i, --include <path>', 'Files to include')
         .parse(process.argv);

if commander.include
  fs.readdir commander.include, (err, files) ->
    files.forEach (file) ->
      if file.match(/\.coffee$/)
        fs.readFile process.cwd() + '/' + commander.include + '/' +file, (err, data) ->
          eval 'with (CSpecGlobal) { ' + coffee.compile(''+data, { bare: true }) + '; for(var variable in exports) { this[variable] = exports[variable]; } }'

new CSpec().run()
